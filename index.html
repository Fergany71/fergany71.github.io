<!DOCTYPE html>
<html lang="ar" dir="rtl" class="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>عمر عطيه الفرجانى | مطور ومبتكر ويب</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Amiri:wght@400;700&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
      :root {
          --bg-color: #f3f4f6; --bg-secondary-color: #ffffff; --text-color: #1f2937;
          --text-secondary-color: #4b5563; --primary-color: #0d9488; --primary-hover-color: #0f766e;
          --border-color: #d1d5db;
          --chat-bg-calm: #111827;
          --chat-bg-calm-secondary: #1f2937;
      }
      html.dark {
          --bg-color: #111827; --bg-secondary-color: #1f2937; --text-color: #f9fafb;
          --text-secondary-color: #9ca3af; --border-color: #4b5563;
          --chat-bg-calm: #030712;
          --chat-bg-calm-secondary: #111827;
      }
      /* Base styles */
      body { font-family: 'Cairo', sans-serif; background-color: var(--bg-color); color: var(--text-color); transition: background-color 0.3s, color 0.3s; overflow-x: hidden;}
      .text-primary { color: var(--primary-color); } .bg-primary { background-color: var(--primary-color); }
      .bg-secondary { background-color: var(--bg-secondary-color); }
      
      /* Preloader */
      #preloader {
          position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          background: linear-gradient(135deg, var(--bg-color) 0%, var(--bg-secondary-color) 100%);
          z-index: 10000;
          display: flex; align-items: center; justify-content: center;
          opacity: 1; visibility: visible;
          transition: opacity 1s ease-in-out, visibility 1s ease-in-out;
          overflow: hidden;
      }
      #preloader.loaded {
          opacity: 0; visibility: hidden; pointer-events: none;
      }
      .preloader-particles {
          position: absolute;
          top: 0; left: 0; width: 100%; height: 100%;
          overflow: hidden;
          z-index: 1;
      }
      .particle {
          position: absolute;
          background: var(--primary-color);
          border-radius: 50%;
          opacity: 0.1;
          animation: float 6s infinite ease-in-out;
      }
      @keyframes float {
          0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.1; }
          50% { transform: translateY(-20px) rotate(180deg); opacity: 0.3; }
      }
      .preloader-content {
          text-align: center;
          z-index: 2;
          position: relative;
          max-width: 90%;
      }
      .preloader-logo {
          width: 80px; height: 80px;
          margin: 0 auto 30px;
          border: 3px solid transparent;
          border-top: 3px solid var(--primary-color);
          border-radius: 50%;
          animation: spin 2s linear infinite;
          position: relative;
          display: flex;
          align-items: center;
          justify-content: center;
      }
      .preloader-logo::before {
          content: '';
          width: 40px; height: 40px;
          border: 2px solid transparent;
          border-top: 2px solid var(--primary-hover-color);
          border-radius: 50%;
          animation: spin 1.5s linear infinite reverse;
      }
      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }
      .preloader-welcome-text {
          font-size: clamp(1.8rem, 5vw, 3rem);
          font-weight: 900;
          background: linear-gradient(45deg, var(--primary-color), var(--primary-hover-color), var(--primary-color));
          background-size: 200% 200%;
          background-clip: text;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          line-height: 1.2;
          overflow: hidden;
          position: relative;
          animation: gradient-shift 3s ease-in-out infinite;
          margin-bottom: 20px;
          opacity: 0;
          transform: translateY(30px);
      }
      @keyframes gradient-shift {
          0%, 100% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
      }
      .preloader-progress {
          width: 300px;
          max-width: 80%;
          height: 4px;
          background: rgba(13, 148, 136, 0.2);
          border-radius: 2px;
          margin: 20px auto;
          overflow: hidden;
          position: relative;
      }
      .preloader-progress-bar {
          height: 100%;
          background: linear-gradient(90deg, var(--primary-color), var(--primary-hover-color));
          border-radius: 2px;
          width: 0%;
          transition: width 0.3s ease;
          position: relative;
      }
      .preloader-progress-bar::after {
          content: '';
          position: absolute;
          top: 0; left: 0;
          height: 100%; width: 100%;
          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
          animation: shimmer 2s infinite;
      }
      @keyframes shimmer {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
      }
      .preloader-status {
          font-size: 1rem;
          color: var(--text-secondary-color);
          margin-top: 15px;
          opacity: 0.8;
          animation: pulse 2s infinite;
      }
      @keyframes pulse {
          0%, 100% { opacity: 0.8; }
          50% { opacity: 1; }
      }
      
      /* Scrollbar */
      #scroll-progress-bar { position: fixed; top: 0; right: 0; height: 3px; background-color: var(--primary-color); width: 0%; z-index: 100; }
      
      /* Header */
      .nav-active { color: var(--primary-color) !important; font-weight: 700; }

      /* --- PROFESSIONAL LOGO STYLES --- */
      .professional-name {
          font-family: 'Amiri', serif;
          font-size: clamp(1.2rem, 3vw, 1.8rem);
          font-weight: 700;
          background: linear-gradient(45deg, var(--primary-color), var(--primary-hover-color), #0891b2, var(--primary-color));
          background-size: 300% 300%;
          background-clip: text;
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          animation: gradient-flow 4s ease-in-out infinite, slide-in-right 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
          position: relative;
          overflow: hidden;
          text-shadow: 0 2px 4px rgba(13, 148, 136, 0.3);
          letter-spacing: 1px;
      }

      .professional-name::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
          animation: shine-text 3s infinite;
      }

      @keyframes gradient-flow {
          0%, 100% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
      }

      @keyframes slide-in-right {
          0% { 
              transform: translateX(100px);
              opacity: 0;
          }
          100% { 
              transform: translateX(0);
              opacity: 1;
          }
      }

      @keyframes shine-text {
          0% { left: -100%; }
          100% { left: 100%; }
      }

      .professional-name:hover {
          animation-play-state: paused;
          transform: scale(1.05);
          transition: transform 0.3s ease;
      }

      /* Theme Toggle Switch */
      .theme-switch-wrapper { display: flex; align-items: center; }
      .theme-switch { display: inline-block; height: 24px; position: relative; width: 44px; }
      .theme-switch input { display:none; }
      .slider { background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 24px; }
      .slider:before { background-color: #fff; bottom: 4px; content: ""; height: 16px; left: 4px; position: absolute; transition: .4s; width: 16px; border-radius: 50%; }
      input:checked + .slider { background-color: var(--primary-color); }
      input:checked + .slider:before { transform: translateX(20px); }
      .slider .fa-moon, .slider .fa-sun { position: absolute; top: 5px; color: #fff; font-size: 14px; transition: opacity 0.4s; }
      .slider .fa-moon { left: 5px; opacity: 0; }
      .slider .fa-sun { right: 5px; opacity: 1; }
      input:checked + .slider .fa-moon { opacity: 1; }
      input:checked + .slider .fa-sun { opacity: 0; }
      
      /* Hero section and background */
      #bg-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
      #hero > div { z-index: 2; position: relative; }

      /* Word Reveal Animation */
      .g-title { display: block; overflow: hidden;}
      .g-title .word { transform: translateY(115%); transition: transform .5s; display: inline-block; padding-left: 4px;}

      /* Enhanced About Section Styles */
      .about-card {
          background: var(--bg-secondary-color);
          border-radius: 20px;
          padding: 2rem;
          box-shadow: 0 10px 30px rgba(0,0,0,0.1);
          border: 1px solid var(--border-color);
          transition: all 0.3s ease;
          position: relative;
          overflow: hidden;
      }

      .about-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(13, 148, 136, 0.1), transparent);
          transition: left 0.5s ease;
      }

      .about-card:hover::before {
          left: 100%;
      }

      .about-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 20px 40px rgba(13, 148, 136, 0.2);
      }

      .skill-tag {
          display: inline-block;
          background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color));
          color: white;
          padding: 0.5rem 1rem;
          border-radius: 25px;
          font-size: 0.9rem;
          font-weight: 600;
          margin: 0.25rem;
          transition: all 0.3s ease;
          position: relative;
          overflow: hidden;
      }

      .skill-tag::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
          transition: left 0.3s ease;
      }

      .skill-tag:hover::before {
          left: 100%;
      }

      .skill-tag:hover {
          transform: scale(1.05);
          box-shadow: 0 5px 15px rgba(13, 148, 136, 0.4);
      }

      .achievement-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: var(--bg-color);
          border-radius: 15px;
          margin-bottom: 1rem;
          transition: all 0.3s ease;
          border-left: 4px solid var(--primary-color);
      }

      .achievement-item:hover {
          transform: translateX(-5px);
          box-shadow: 0 5px 15px rgba(13, 148, 136, 0.2);
      }

      .achievement-icon {
          width: 50px;
          height: 50px;
          background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color));
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-size: 1.2rem;
          flex-shrink: 0;
      }

      /* --- AI ASSISTANT WIDGET --- */
      #chat-widget { 
          position: fixed; 
          bottom: 20px; 
          right: 20px; 
          z-index: 1050; /* Needs to be on top of the overlay */
          font-family: 'Cairo', sans-serif;
          display: flex;
          flex-direction: column;
          align-items: center;
      }
      
      #chat-bubble {
          width: 60px;
          height: 60px;
          cursor: pointer;
          position: relative;
          display: flex;
          align-items: center;
          justify-content: center;
          transform-style: preserve-3d;
          transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1);
          order: 2; 
      }

      #chat-bubble:hover {
          transform: scale(1.15);
      }

      .ai-icon-core {
          width: 100%;
          height: 100%;
          border-radius: 50%;
          background: radial-gradient(circle at 30% 30%, #4f46e5, #1e293b 80%);
          box-shadow: 
              inset 0 0 15px rgba(79, 70, 229, 0.6), 
              0 0 20px -5px #4f46e5,
              0 0 40px -15px #000;
          position: relative;
          animation: core-pulse 4s infinite ease-in-out;
      }
      @keyframes core-pulse {
          0%, 100% { transform: scale(1); box-shadow: inset 0 0 15px rgba(79, 70, 229, 0.6), 0 0 20px -5px #4f46e5, 0 0 40px -15px #000; }
          50% { transform: scale(1.05); box-shadow: inset 0 0 20px rgba(139, 92, 246, 0.7), 0 0 30px 0px #4f46e5, 0 0 50px -10px #000; }
      }
      
      .ai-icon-rings, .ai-icon-rings::before, .ai-icon-rings::after {
          content: '';
          position: absolute;
          top: 50%; left: 50%;
          border: 1px solid;
          border-radius: 50%;
          transform-style: preserve-3d;
      }
      
      .ai-icon-rings {
          width: 150%; height: 150%;
          border-color: rgba(79, 70, 229, 0.3);
          animation: rotate3d 10s linear infinite;
          transform: translate(-50%, -50%) rotateY(70deg) rotateX(10deg);
      }
      .ai-icon-rings::before {
          width: 130%; height: 130%;
          border-color: rgba(139, 92, 246, 0.4);
          animation: rotate3d 15s linear infinite reverse;
          transform: translate(-50%, -50%) rotateY(-20deg) rotateX(45deg);
      }
      .ai-icon-rings::after {
          width: 110%; height: 110%;
          border-color: rgba(59, 130, 246, 0.5);
          animation: rotate3d 8s linear infinite;
          transform: translate(-50%, -50%) rotateY(10deg) rotateX(-30deg);
      }
      @keyframes rotate3d { from { transform: translate(-50%, -50%) rotateY(70deg) rotateX(10deg) rotate(0deg); } to { transform: translate(-50%, -50%) rotateY(70deg) rotateX(10deg) rotate(360deg); } }
      
      .ai-icon-glow {
          position: absolute;
          top: 0; left: 0;
          width: 100%; height: 100%;
          border-radius: 50%;
          background: #4f46e5;
          filter: blur(25px);
          opacity: 0.3;
          animation: glow-flicker 4s infinite ease-in-out;
      }
      @keyframes glow-flicker {
          0%, 100% { opacity: 0.3; transform: scale(0.95); }
          50% { opacity: 0.5; transform: scale(1.05); }
      }

      /* Chat bubble label for better visibility */
      .chat-bubble-label {
          background: var(--primary-color);
          color: white;
          padding: 5px 12px;
          border-radius: 16px;
          font-size: 13px;
          font-weight: bold;
          white-space: nowrap;
          margin-bottom: 12px;
          order: 1; 
          position: relative;
          box-shadow: 0 4px 10px rgba(0,0,0,0.15);
          animation: label-pulse 3s infinite ease-in-out;
          transition: opacity 0.3s ease-out, transform 0.3s ease-out;
          transform-origin: bottom center;
      }
      .chat-bubble-label::after {
           content: '';
           position: absolute;
           bottom: -5px;
           left: 50%;
           transform: translateX(-50%);
           width: 0;
           height: 0;
           border-left: 6px solid transparent;
           border-right: 6px solid transparent;
           border-top: 6px solid var(--primary-color);
      }
      @keyframes label-pulse {
          0%, 100% { transform: translateY(0) scale(1); }
          50% { transform: translateY(-3px) scale(1.03); }
      }
      
      #chat-window.open ~ .chat-bubble-label {
          opacity: 0;
          transform: translateY(10px) scale(0.8);
          pointer-events: none;
      }


      /* --- MODIFIED: CHAT WINDOW LAYOUT & FOCUS --- */
      #chat-window { 
          position: absolute; 
          bottom: 90px;
          right: 0; 
          /* MODIFIED: Increased Size */
          width: 480px; 
          max-width: 95vw; 
          height: 700px; 
          max-height: 85vh; 
          background: var(--chat-bg-calm-secondary);
          border: 1px solid rgba(100, 116, 139, 0.3); 
          border-radius: 25px; 
          box-shadow: 0 25px 80px rgba(0,0,0,0.25), 0 0 0 1px rgba(255,255,255,0.1);
          display: flex; 
          flex-direction: column; /* Key for layout */
          overflow: hidden; 
          transform-origin: bottom right; 
          transform: scale(0.3) translateY(20px); 
          opacity: 0; 
          pointer-events: none; 
          /* SUPER SMOOTH Transition */
          transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      #chat-window.open { 
          transform: scale(1) translateY(0); 
          opacity: 1; 
          pointer-events: auto; 
      }
      
      #chat-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(17, 24, 39, 0.6); /* --bg-color dark at 60% opacity */
          backdrop-filter: blur(5px);
          -webkit-backdrop-filter: blur(5px);
          z-index: 1040; /* Below chat widget, above everything else */
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }
      #chat-overlay.active {
          opacity: 1;
          pointer-events: auto;
      }


      .chat-header {
          padding: 20px; 
          background: rgba(3, 7, 18, 0.5); 
          backdrop-filter: blur(10px);
          color: white;
          border-bottom: 1px solid rgba(100, 116, 139, 0.3);
          position: relative;
          z-index: 10;
          flex-shrink: 0; /* Prevent header from shrinking */
      }
      
      .chat-header h3 {
          margin: 0;
          font-size: 1.2rem;
          font-weight: 700;
          display: flex;
          align-items: center;
          gap: 12px;
          font-family: 'Amiri', serif;
      }
      
      .chat-status {
          font-size: 0.8rem;
          opacity: 0.9;
          margin-top: 5px;
          display: flex;
          align-items: center;
          gap: 8px;
      }
      
      .status-indicator {
          width: 8px;
          height: 8px;
          background: linear-gradient(45deg, #34d399, #10b981);
          border-radius: 50%;
          animation: smart-status-blink 2.5s infinite;
          box-shadow: 0 0 10px #34d399;
      }
      
      @keyframes smart-status-blink {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.6; transform: scale(1.2); }
      }
      
      /* This is the main conversation area */
      #chat-messages { 
          flex-grow: 1; /* This makes it take up all available space */
          padding: 20px; 
          overflow-y: auto; 
          display: flex; 
          flex-direction: column; 
          gap: 15px;
          background-color: var(--chat-bg-calm);
          background-image: radial-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px);
          background-size: 15px 15px;
      }
      
      .message { 
          padding: 12px 18px; 
          border-radius: 20px; 
          max-width: 85%; 
          line-height: 1.6;
          position: relative;
          animation: message-appear 0.3s ease-out;
          color: var(--text-color); 
      }
      
      @keyframes message-appear {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
      }
      
      .message.user { 
          background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color));
          color: white; 
          align-self: flex-start; 
          border-bottom-left-radius: 5px;
          box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
      }
      
      .message.ai { 
          background: var(--chat-bg-calm-secondary);
          border: 1px solid var(--border-color);
          align-self: flex-end; 
          border-bottom-right-radius: 5px; 
          display: flex; 
          align-items: flex-start; 
          gap: 12px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      
      .message.ai .ai-avatar {
          width: 32px; 
          height: 32px; 
          border-radius: 50%;
          background: linear-gradient(135deg, #4f46e5, #a78bfa);
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-size: 14px;
          flex-shrink: 0;
          margin-top: 2px;
      }
      
      .message.ai p, .message.ai ul, .message.ai ol { margin-bottom: 0.5rem; }
      .message.ai ul { padding-right: 1.2rem; list-style-type: '✅ '; }
      .message.ai ol { padding-right: 1.2rem; }
      .message.ai strong { color: var(--primary-color); }
      .message.ai code { 
          background-color: var(--chat-bg-calm);
          color: #93c5fd;
          border: 1px solid var(--border-color);
          padding: 3px 8px; 
          border-radius: 6px; 
          font-family: 'Courier New', monospace;
          font-size: 0.9em;
      }
      
      /* MODIFIED: This is the quick replies area, it is now much smaller */
      #chat-quick-replies { 
          padding: 8px 15px 12px; 
          display: flex; 
          flex-wrap: wrap; 
          gap: 8px;
          background: var(--chat-bg-calm);
          border-top: 1px solid var(--border-color);
          flex-shrink: 0; /* Prevent this from shrinking */
          max-height: 110px; /* Limit height */
          overflow-y: auto; /* Allow scrolling if many suggestions */
      }
      
      .quick-reply-btn { 
          background: transparent; 
          border: 1px solid var(--primary-color); 
          color: var(--primary-color); 
          padding: 6px 12px; 
          font-size: 0.8rem; 
          border-radius: 16px; 
          cursor: pointer; 
          transition: all 0.2s ease-in-out;
          font-weight: 600;
      }
      
      .quick-reply-btn:hover {
          background-color: var(--primary-color);
          color: white;
          transform: translateY(-1px);
      }
      
      #chat-input-wrapper { 
          display: flex; 
          align-items: center; 
          padding: 15px 20px; 
          border-top: 1px solid var(--border-color);
          background: var(--chat-bg-calm-secondary);
          border-radius: 0 0 25px 25px;
          flex-shrink: 0; /* Prevent this from shrinking */
      }
      
      #chat-input { 
          flex-grow: 1; 
          border: 2px solid var(--border-color); 
          background: var(--chat-bg-calm);
          padding: 12px 16px; 
          color: var(--text-color); 
          outline: none;
          border-radius: 25px;
          font-size: 0.95rem;
          transition: all 0.3s ease;
          margin-left: 10px;
      }
      
      #chat-input:focus {
          border-color: var(--primary-color);
          box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
      }
      
      #chat-send-btn { 
          background: linear-gradient(135deg, var(--primary-color), var(--primary-hover-color));
          color: white; 
          border: none; 
          border-radius: 50%; 
          width: 45px; 
          height: 45px; 
          font-size: 1.2rem; 
          cursor: pointer; 
          display: flex; 
          align-items: center; 
          justify-content: center;
          transition: all 0.3s ease;
          box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
      }
      
      #chat-send-btn:hover {
          transform: scale(1.1);
          box-shadow: 0 6px 16px rgba(13, 148, 136, 0.4);
      }
      
      #chat-send-btn:active {
          transform: scale(0.95);
      }
  </style>
</head>
<body>
  <div id="scroll-progress-bar"></div>
  
  <div id="preloader">
      <div class="preloader-particles" id="preloader-particles"></div>
      <div class="preloader-content">
          <div class="preloader-logo"></div>
          <h1 id="preloader-text" class="preloader-welcome-text"></h1>
          <div class="preloader-progress">
              <div class="preloader-progress-bar" id="preloader-progress-bar"></div>
          </div>
          <div class="preloader-status" id="preloader-status">جاري التحميل...</div>
      </div>
  </div>

  <header class="bg-secondary/80 backdrop-blur-sm shadow-md fixed top-0 left-0 right-0 z-50">
      <div class="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
          <div class="flex items-center gap-4">
              <a href="#hero" class="logo-container flex items-center gap-4" style="text-decoration: none;">
                  <span class="professional-name">عمر عطيه الفرجانى</span>
              </a>
          </div>
          
          <nav id="main-nav" class="hidden lg:flex items-center space-x-6 space-x-reverse text-text-color">
              <a href="#hero" class="nav-link hover:text-primary transition-colors">الرئيسية</a>
              <a href="#about" class="nav-link hover:text-primary transition-colors">عني</a>
              <a href="#services" class="nav-link hover:text-primary transition-colors">خدماتي</a>
              <a href="#contact" class="nav-link hover:text-primary transition-colors">تواصل</a>
          </nav>
          
          <div class="flex items-center space-x-3 space-x-reverse">
               <div class="theme-switch-wrapper">
                  <label class="theme-switch" for="theme-checkbox">
                      <input type="checkbox" id="theme-checkbox" />
                      <div class="slider">
                          <i class="fas fa-moon"></i><i class="fas fa-sun"></i>
                      </div>
                  </label>
               </div>
               <a href="#contact" class="hidden md:block bg-primary text-white font-bold text-sm py-2 px-4 rounded-full hover:bg-primary-hover transition-all transform hover:scale-105">اطلب خدمة</a>
               <button id="mobile-menu-button" class="lg:hidden text-2xl text-text-color"><i class="fas fa-bars"></i></button>
          </div>
      </div>
      <div id="mobile-menu" class="hidden lg:hidden bg-secondary/95 backdrop-blur-sm p-4">
          <div class="flex justify-between items-center mb-4 text-sm text-text-secondary-color">
              <a href="#contact" class="nav-link-mobile bg-primary text-white font-bold text-sm py-2 px-4 rounded-full">اطلب خدمة</a>
          </div>
          <a href="#hero" class="nav-link-mobile block text-center py-3 text-lg hover:bg-primary hover:text-white rounded-lg">الرئيسية</a>
          <a href="#about" class="nav-link-mobile block text-center py-3 text-lg hover:bg-primary hover:text-white rounded-lg">عني</a>
          <a href="#services" class="nav-link-mobile block text-center py-3 text-lg hover:bg-primary hover:text-white rounded-lg">خدماتي</a>
          <a href="#contact" class="nav-link-mobile block text-center py-3 text-lg hover:bg-primary hover:text-white rounded-lg">تواصل</a>
      </div>
  </header>

  <main>
      <section id="hero" class="min-h-screen flex items-center bg-secondary relative overflow-hidden">
          <canvas id="bg-canvas"></canvas>
          <div class="container mx-auto px-6 text-center">
              <h1 class="text-4xl md:text-7xl font-black leading-tight reveal">أنا <span class="text-primary">عمر عطيه الفرجانى</span></h1>
              <p class="text-xl md:text-3xl mt-4 text-text-secondary-color reveal" data-delay="0.2">أُحوّل الأفكار إلى تجارب رقمية مبتكرة.</p>
          </div>
      </section>

      <section id="about" class="py-24 bg-color">
           <div class="container mx-auto px-6">
              <div class="text-center mb-16"> 
                  <h2 class="text-4xl font-bold g-title" data-text="شغف، كود، وإبداع"></h2> 
              </div>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                  <!-- Personal Info Card -->
                  <div class="about-card reveal">
                      <div class="flex items-center gap-4 mb-6">
                          <div class="achievement-icon">
                              <i class="fas fa-user"></i>
                          </div>
                          <h3 class="text-2xl font-bold text-primary">من أنا؟</h3>
                      </div>
                      <p class="text-lg leading-relaxed mb-6">
                          اسمي <strong class="text-primary">عمر عطيه الفرجانى</strong>، عندي 17 سنة وطالب في تالتة ثانوي. 
                          اتولدت في 30 مايو 2008 في قرية الملاك بعزبة الفرجانى. 
                          من صغري وأنا مفتون بعالم التكنولوجيا والبرمجة، وبحب أحول الأفكار المعقدة لحلول رقمية بسيطة وفعالة.
                      </p>
                      
                      <div class="achievement-item">
                          <div class="achievement-icon">
                              <i class="fas fa-birthday-cake"></i>
                          </div>
                          <div>
                              <h4 class="font-bold">تاريخ الميلاد</h4>
                              <p class="text-text-secondary-color">30 مايو 2008</p>
                          </div>
                      </div>
                      
                      <div class="achievement-item">
                          <div class="achievement-icon">
                              <i class="fas fa-map-marker-alt"></i>
                          </div>
                          <div>
                              <h4 class="font-bold">مكان الميلاد</h4>
                              <p class="text-text-secondary-color">قرية الملاك - عزبة الفرجانى</p>
                          </div>
                      </div>
                      
                      <div class="achievement-item">
                          <div class="achievement-icon">
                              <i class="fas fa-graduation-cap"></i>
                          </div>
                          <div>
                              <h4 class="font-bold">المرحلة التعليمية</h4>
                              <p class="text-text-secondary-color">طالب في الصف الثالث الثانوي</p>
                          </div>
                      </div>
                  </div>

                  <!-- Skills & Passion Card -->
                  <div class="about-card reveal" data-delay="0.2">
                      <div class="flex items-center gap-4 mb-6">
                          <div class="achievement-icon">
                              <i class="fas fa-code"></i>
                          </div>
                          <h3 class="text-2xl font-bold text-primary">شغفي ومهاراتي</h3>
                      </div>
                      <p class="text-lg leading-relaxed mb-6">
                          بحب جداً مجال <strong class="text-primary">البرمجة والاختراق الأخلاقي</strong>، وبشوف في كل سطر كود تحدي جديد وفرصة عشان أتعلم حاجة مميزة. 
                          هدفي إني أكون مطور محترف قادر على بناء تطبيقات ومواقع تخدم المجتمع وتحل مشاكل حقيقية.
                      </p>
                      
                      <h4 class="text-xl font-bold mb-4">مجالات تخصصي:</h4>
                      <div class="flex flex-wrap gap-2 mb-6">
                          <span class="skill-tag">تطوير الواجهات الأمامية</span>
                          <span class="skill-tag">React & Next.js</span>
                          <span class="skill-tag">تصميم UI/UX</span>
                          <span class="skill-tag">الاختراق الأخلاقي</span>
                          <span class="skill-tag">أساسيات الأمان</span>
                          <span class="skill-tag">JavaScript</span>
                          <span class="skill-tag">HTML & CSS</span>
                          <span class="skill-tag">تطوير المواقع</span>
                      </div>
                      
                      <div class="achievement-item">
                          <div class="achievement-icon">
                              <i class="fas fa-heart"></i>
                          </div>
                          <div>
                              <h4 class="font-bold">فلسفتي في العمل</h4>
                              <p class="text-text-secondary-color">أؤمن بأن التكنولوجيا يجب أن تكون في خدمة الإنسان، وأن كل مشروع هو فرصة لتعلم شيء جديد وإضافة قيمة حقيقية.</p>
                          </div>
                      </div>
                  </div>
              </div>
              
              <div class="mt-16">
                  <div class="about-card reveal" data-delay="0.4">
                      <div class="text-center mb-8">
                          <div class="achievement-icon mx-auto mb-4">
                              <i class="fas fa-rocket"></i>
                          </div>
                          <h3 class="text-3xl font-bold text-primary">رؤيتي للمستقبل</h3>
                      </div>
                      
                      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                          <div class="text-center">
                              <div class="achievement-icon mx-auto mb-4">
                                  <i class="fas fa-lightbulb"></i>
                              </div>
                              <h4 class="text-xl font-bold mb-2">الإبداع والابتكار</h4>
                              <p class="text-text-secondary-color">أسعى لتطوير حلول مبتكرة تجمع بين الجمال والوظيفة، وتقدم تجربة مستخدم استثنائية.</p>
                          </div>
                          
                          <div class="text-center">
                              <div class="achievement-icon mx-auto mb-4">
                                  <i class="fas fa-shield-alt"></i>
                              </div>
                              <h4 class="text-xl font-bold mb-2">الأمان والحماية</h4>
                              <p class="text-text-secondary-color">أهتم بتطبيق أعلى معايير الأمان في كل مشروع، لضمان حماية البيانات والخصوصية.</p>
                          </div>
                          
                          <div class="text-center">
                              <div class="achievement-icon mx-auto mb-4">
                                  <i class="fas fa-users"></i>
                              </div>
                              <h4 class="text-xl font-bold mb-2">خدمة المجتمع</h4>
                              <p class="text-text-secondary-color">أؤمن بقوة التكنولوجيا في تحسين حياة الناس وحل المشاكل الحقيقية في مجتمعنا.</p>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </section>
      
      <section id="services" class="py-24 bg-secondary">
          <div class="container mx-auto px-6">
              <div class="text-center mb-16"> <h2 class="text-4xl font-bold g-title" data-text="ماذا أقدم؟"></h2> </div>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
          </div>
      </section>
      
      <section id="contact" class="py-24 bg-color">
           <div class="container mx-auto px-6 text-center">
               <div class="text-center mb-12">
                  <h2 class="text-4xl font-bold g-title" data-text="هل لديك فكرة؟"></h2>
                  <p class="text-lg text-text-secondary-color mt-4 reveal" data-delay="0.2">أنا هنا للمساعدة. تواصل معي ودعنا نبدأ العمل!</p>
              </div>
              <div class="flex flex-col items-center gap-6 reveal" data-delay="0.4">
                  <a href="mailto:omarfergany100@gmail.com" class="bg-primary text-white font-bold text-xl py-4 px-10 rounded-lg hover:bg-primary-hover transition-all duration-300 transform hover:scale-105 inline-block">
                      <i class="fas fa-paper-plane ml-2"></i> omarfergany100@gmail.com
                  </a>
                  <div class="flex justify-center space-x-6 space-x-reverse">
                      <a href="https://www.facebook.com/share/14DMwBB4TVV/" target="_blank" class="magnetic-icon text-text-secondary-color hover:text-blue-600 transition-all duration-300 transform hover:scale-125"><i class="fab fa-facebook fa-2x"></i></a>
                      <a href="https://www.instagram.com/fergany___x" target="_blank" class="magnetic-icon text-text-secondary-color hover:text-pink-500 transition-all duration-300 transform hover:scale-125"><i class="fab fa-instagram fa-2x"></i></a>
                      <a href="https://wa.me/201225860308" target="_blank" class="magnetic-icon text-text-secondary-color hover:text-green-500 transition-all duration-300 transform hover:scale-125"><i class="fab fa-whatsapp fa-2x"></i></a>
                  </div>
              </div>
           </div>
      </section>
  </main>
  
  <footer class="bg-gray-900 text-gray-400 py-6"><div class="container mx-auto px-6 text-center"><p>© 2024 | صُنع بحب وشغف بواسطة <span class="font-bold text-primary">عمر عطيه الفرجانى</span></p></div></footer>
  
  <!-- NEW: Overlay for focus effect -->
  <div id="chat-overlay"></div>

  <div id="chat-widget">
      <div id="chat-window">
          <div class="chat-header">
              <h3>
                  <i class="fas fa-robot" style="color: #a78bfa;"></i>
                  المساعد الشخصي لـ عمر
              </h3>
              <div class="chat-status">
                  <div class="status-indicator"></div>
                  متصل وجاهز للمساعدة
              </div>
          </div>
          <div id="chat-messages"></div>
          <div id="chat-quick-replies"></div>
          <div id="chat-input-wrapper">
              <input id="chat-input" type="text" placeholder="اسأل أي حاجة..." autocomplete="off">
              <button id="chat-send-btn"><i class="fas fa-paper-plane"></i></button>
          </div>
      </div>
      
      <div class="chat-bubble-label">المساعد الذكي</div>

      <div id="chat-bubble">
          <div class="ai-icon-glow"></div>
          <div class="ai-icon-rings"></div>
          <div class="ai-icon-core"></div>
      </div>
  </div>
  
<script>
document.addEventListener('DOMContentLoaded', () => {
  // This script is responsible for all the dynamic functionality of the website.
  const docHtml = document.documentElement;

  // Preloader
  const preloader = document.getElementById('preloader');
  if (preloader) {
      const textEl = document.getElementById('preloader-text');
      const progressBar = document.getElementById('preloader-progress-bar');
      const statusEl = document.getElementById('preloader-status');
      const particlesContainer = document.getElementById('preloader-particles');
      const welcomeText = "أهلاً بك في موقع عمر الفرجانى";

      const createParticles = () => {
          if (!particlesContainer) return;
          for (let i = 0; i < 50; i++) {
              const particle = document.createElement('div');
              particle.className = 'particle';
              particle.style.left = Math.random() * 100 + '%';
              particle.style.top = Math.random() * 100 + '%';
              particle.style.width = Math.random() * 4 + 2 + 'px';
              particle.style.height = particle.style.width;
              particle.style.animationDelay = Math.random() * 6 + 's';
              particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
              particlesContainer.appendChild(particle);
          }
      };

      if(textEl) {
         textEl.textContent = welcomeText;
         gsap.to(textEl, {
             opacity: 1,
             y: 0,
             duration: 1,
             ease: 'power3.out',
             delay: 0.5
         });
      }
      
      let progress = 0;
      const statusMessages = [
          'جاري التحميل...', 'تحضير الواجهة...', 'تحميل المحتوى...',
          'تطبيق التصميم...', 'تجهيز التفاعلات...', 'اكتمل التحميل!'
      ];

      const updateProgress = () => {
          if (progress < 100) {
              progress += 2;
              if (progress > 100) progress = 100;
              if(progressBar) progressBar.style.width = progress + '%';
              const statusIndex = Math.floor((progress / 100) * (statusMessages.length - 1));
              if(statusEl) statusEl.textContent = statusMessages[statusIndex];
              setTimeout(updateProgress, 100);
          }
      };

      const hidePreloader = () => {
          gsap.to(preloader, {
              opacity: 0,
              duration: 1,
              ease: 'power2.inOut',
              onComplete: () => {
                  preloader.classList.add('loaded');
              }
          });
      };

      createParticles();
      setTimeout(updateProgress, 500);
      setTimeout(hidePreloader, 6000);
  }

  // Header Features
  const scrollProgressBar = document.getElementById('scroll-progress-bar');
  function updateHeader() {
      if (scrollProgressBar) {
          const scrollTotal = docHtml.scrollHeight - docHtml.clientHeight;
          scrollProgressBar.style.width = `${(window.scrollY / scrollTotal) * 100}%`;
      }
  }
  window.addEventListener('scroll', updateHeader);
  updateHeader();

  // Theme Switcher
  const themeCheckbox = document.getElementById('theme-checkbox');
  function applyTheme(theme) {
      docHtml.classList.remove('light', 'dark');
      docHtml.classList.add(theme);
      localStorage.setItem('theme', theme);
  }
  const currentTheme = localStorage.getItem('theme') || 'light';
  applyTheme(currentTheme);
  if(themeCheckbox) {
      if (currentTheme === 'dark') themeCheckbox.checked = true;
      themeCheckbox.addEventListener('change', () => {
          applyTheme(themeCheckbox.checked ? 'dark' : 'light');
      });
  }

  // GSAP Word Animation
  gsap.registerPlugin(ScrollTrigger);
  document.querySelectorAll(".g-title").forEach(title => {
      if(title.dataset.text) {
          const words = title.dataset.text.split(/(\s|,|\?)/);
          title.textContent = "";
          words.forEach(word => {
              if (word.trim().length > 0) {
                  const span = document.createElement("span");
                  span.className = "word";
                  span.textContent = word;
                  title.appendChild(span);
              } else {
                   title.appendChild(document.createTextNode(word));
              }
          });
          gsap.from(title.querySelectorAll(".word"), {
              y: '115%', stagger: 0.1, duration: 0.5, ease: 'power3.out',
              scrollTrigger: { trigger: title, start: "top 90%", toggleActions: "play none none none" }
          });
      }
  });

  // Service Cards
  const services = [
      { icon: 'fa-laptop-code', title: 'تطوير الواجهات', desc: 'بناء واجهات ويب تفاعلية وسريعة باستخدام أحدث التقنيات زي React و Next.js.' },
      { icon: 'fa-palette', title: 'تصميم UI/UX', desc: 'تصميم تجارب مستخدم سهلة وجذابة بتركز على تحقيق أهدافك ورضا المستخدمين.' },
      { icon: 'fa-user-shield', title: 'أساسيات الأمان', desc: 'تطبيق مفاهيم الأمان الأساسية لحماية مواقع الويب، كجزء من شغفه بمجال الاختراق.' }
  ];
  const servicesContainer = document.querySelector('#services .grid');
  if (servicesContainer) {
      servicesContainer.innerHTML = services.map((service, index) => `
          <div class="bg-secondary p-8 rounded-lg shadow-lg transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 reveal" data-delay="${index * 0.2}">
              <i class="fas ${service.icon} fa-3x text-primary mb-4"></i>
              <h3 class="text-2xl font-bold mb-2">${service.title}</h3>
              <p class="text-text-secondary-color">${service.desc}</p>
          </div>
      `).join('');
  }
  
  // Nav & Mobile Menu Logic
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  if(mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
  }
  document.querySelectorAll('.nav-link-mobile, .nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
          if(link.classList.contains('nav-link-mobile') && mobileMenu) {
              mobileMenu.classList.add('hidden');
          }
          const targetId = link.getAttribute('href');
          if(targetId && document.querySelector(targetId)) {
             e.preventDefault();
             document.querySelector(targetId).scrollIntoView({ behavior: 'smooth' });
          }
      });
  });

  const navLinks = document.querySelectorAll('#main-nav .nav-link');
  const pageSections = document.querySelectorAll('main section');
  function updateActiveLink() {
      let current = '';
      if (pageSections.length > 0) {
          current = pageSections[0].id;
      }
      pageSections.forEach(section => {
          if (section && window.scrollY >= section.offsetTop - 150) {
              current = section.id;
          }
      });
      navLinks.forEach(link => {
          link.classList.remove('nav-active');
          if (link.getAttribute('href') === '#' + current) {
              link.classList.add('nav-active');
          }
      });
  }
  window.addEventListener('scroll', updateActiveLink);
  updateActiveLink();

  // --- Gemini AI Chatbot ---
  const chatWidget = {
      bubble: document.getElementById('chat-bubble'),
      window: document.getElementById('chat-window'),
      overlay: document.getElementById('chat-overlay'), 
      messages: document.getElementById('chat-messages'),
      input: document.getElementById('chat-input'),
      sendBtn: document.getElementById('chat-send-btn'),
      quickReplies: document.getElementById('chat-quick-replies'),
      apiKey: 'AIzaSyD39lIpfEjoPYM6NcOxWtM3pQym9ZrkXfo',
      history: [], 

      init() {
          if (!this.bubble || !this.window || !this.sendBtn || !this.input || !this.overlay) return;
          this.bubble.addEventListener('click', () => this.toggle());
          this.overlay.addEventListener('click', () => this.toggle()); 
          this.sendBtn.addEventListener('click', () => this.sendMessage());
          this.input.addEventListener('keypress', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); this.sendMessage(); } });
      },
      toggle() {
          const isOpen = this.window.classList.toggle('open');
          this.overlay.classList.toggle('active', isOpen); 

          if(isOpen && this.messages.children.length === 0) {
               this.addMessage("أهلاً بيك يا غالي! أنا المساعد الشخصي الخاص بـ عمر الفرجانى، خد راحتك واسأل في أي حاجة تخطر على بالك. 😉", 'ai');
               this.showQuickReplies([
                   "عمر عايش فين؟ 📍",
                   "عنده كام سنة؟ 🎂",
                   "إيه هي طرق التواصل معاه؟ 📞",
                   "إيه خططه للمستقبل؟ 🎓"
               ]);
          }
      },
      sendMessage() {
          const userMessage = this.input.value.trim();
          if (!userMessage) return;
          this.addMessage(userMessage, 'user');
          this.input.value = '';
          this.quickReplies.innerHTML = '';
          this.getAIResponse(userMessage);
      },
      sendQuickReply(text) {
          this.addMessage(text, 'user');
          this.quickReplies.innerHTML = '';
          this.getAIResponse(text);
      },
      addMessage(content, type) {
          const div = document.createElement('div');
          div.className = `message ${type}`;
          if (type === 'ai') {
              const avatar = `<div class="ai-avatar"><i class="fas fa-robot"></i></div>`;
              const textContent = `<div>${marked.parse(content, { gfm: true, breaks: true })}</div>`;
              div.innerHTML = avatar + textContent;
          } else {
              div.textContent = content;
          }
          this.messages.appendChild(div);
          this.messages.scrollTop = this.messages.scrollHeight;
      },
      showQuickReplies(replies) {
          this.quickReplies.innerHTML = '';
          if (replies.length === 0) {
              // Ensure the element doesn't take up space if empty
              this.quickReplies.style.display = 'none';
              return;
          }
          
          this.quickReplies.style.display = 'flex';
          const title = document.createElement('p');
          title.textContent = 'اقتراحات:';
          title.className = 'w-full text-sm text-text-secondary-color mb-1 px-2';
          this.quickReplies.appendChild(title);

          replies.forEach(text => {
              const btn = document.createElement('button');
              btn.className = 'quick-reply-btn';
              btn.textContent = text;
              btn.onclick = () => this.sendQuickReply(text);
              this.quickReplies.appendChild(btn);
          });
      },
      
      async getAIResponse(prompt) {
          const loadingDiv = document.createElement('div');
          loadingDiv.className = 'message ai';
          loadingDiv.innerHTML = `<div class="ai-avatar"><i class="fas fa-robot"></i></div><div><span class="animate-pulse">بفكر في رد مناسب... 🤔</span></div>`;
          this.messages.appendChild(loadingDiv);
          this.messages.scrollTop = this.messages.scrollHeight;

          const systemPrompt = `أنت مساعد ذكاء اصطناعي شخصي لمطور ويب اسمه عمر عطيه الفرجانى. اسمك 'المساعد الشخصي'. ردودك يجب أن تكون باللهجة المصرية العامية، ودودة، ومرحة، ومفيدة جداً.

          **معلومات أساسية ومفصلة عن عمر (استخدمها في ردودك بذكاء):**
          - **الاسم الكامل:** عمر عطيه الفرجانى.
          - **تاريخ الميلاد:** 30 مايو 2008.
          - **العمر:** 17 سنة (حالياً في الصف الثالث الثانوي).
          - **مكان الإقامة:** قرية الملاك، التابعة لمركز أبو حماد، في محافظة الشرقية.
          - **الطموح الأكاديمي:** هدفه بعد الثانوية العامة هو دخول كلية الطب.
          - **الشغف والمهارات:** البرمجة (خصوصاً برمجة مواقع الويب وبوتات التليجرام)، الاختراق الأخلاقي، والذكاء الاصطناعي.
          - **فلسفته في العمل:** يستمتع جدًا بحل مشاكل الأكواد الصعبة، وشغوف ببرمجة وتصميم واجهات ذكية وأنيقة جدًا.
          - **الهوايات الأخرى:** ممارسة الرياضة.

          **معلومات التواصل (استخدمها فقط عند السؤال الصريح عنها):**
          - **الإيميل:** omarfergany100@gmail.com
          - **فيسبوك:** https://www.facebook.com/share/14DMwBB4TVV/
          - **انستجرام:** https://www.instagram.com/fergany___x
          - **واتساب:** https://wa.me/201225860308

          **تعليمات مهمة لردودك:**
          1. استخدم اللهجة المصرية العامية وخليك ودود.
          2. استخدم الإيموجيز بشكل مناسب لجعل الكلام ممتع.
          3. لا تذكر أبدًا أنك نموذج لغوي أو تذكر اسم الشركة التي طورتك. أنت 'المساعد الشخصي' لعمر.
          4. جاوب على الأسئلة بناءً على المعلومات المفصلة أعلاه. لو سُئلت عن شيء غير مذكور، يمكنك القول "دي تفصيلة ممكن تسأل عمر فيها مباشرة عشان يديك أدق إجابة 😉".
          5. **الأهم:** بعد كل إجابة، **لازم** تقترح من 3 إلى 4 أسئلة متابعة ذكية ومختلفة لها علاقة بالموضوع. اكتب كل سؤال في سطر جديد لوحده، وابدأ كل سؤال بشرطة ومسافة. مثال:
          - إيه اللي خلاه يجمع بين الطب والبرمجة؟
          - إيه نوع الرياضة اللي بيمارسها؟`;

          this.history.push({ role: "user", parts: [{ text: prompt }] });
          const payload = {
              contents: [ { role: "model", parts: [{ text: systemPrompt }] }, ...this.history ]
          };

          try {
              const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${this.apiKey}`, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(payload)
              });

              if (!response.ok) { 
                  const errorBody = await response.text();
                  throw new Error(`API request failed with status ${response.status}: ${errorBody}`); 
              }
              const data = await response.json();
              this.messages.removeChild(loadingDiv);
              
              if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts) {
                  const aiText = data.candidates[0].content.parts[0].text;
                  
                  const questionRegex = /^\s*-\s*(.+)/gm;
                  const suggestedQuestions = [];
                  const cleanAiText = aiText.replace(questionRegex, (match, p1) => {
                      suggestedQuestions.push(p1.trim());
                      return ''; // Return empty string to remove the line
                  }).trim();
                  
                  this.addMessage(cleanAiText, 'ai');
                  this.history.push({ role: "model", parts: [{ text: aiText }] });
                  this.showQuickReplies(suggestedQuestions);

              } else {
                  console.log("No valid response from API:", data);
                  this.addMessage("معلش، شكلي سرحت شوية. ممكن تسأل تاني؟", 'ai');
              }

          } catch (error) {
              console.error("Gemini API Error:", error);
              this.messages.removeChild(loadingDiv);
              this.addMessage("عفواً، حصل خطأ فني ومش قادر أرد عليك دلوقتي. 🔌 ممكن تكون مفتاح الـ API فيه مشكلة. جرب تاني كمان شوية.", 'ai');
          } finally {
              if (this.history.length > 10) { this.history = this.history.slice(-10); }
          }
      }
  };
  chatWidget.init();
  
  // 3D Background
  try {
      const bgCanvas = document.getElementById('bg-canvas');
      if (bgCanvas) {
          let scene = new THREE.Scene();
          let camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
          let renderer = new THREE.WebGLRenderer({ canvas: bgCanvas, alpha: true });
          renderer.setSize(window.innerWidth, window.innerHeight);
          let stars = [];
          for (let i = 0; i < 1000; i++) {
              let star = new THREE.Vector3(
                  THREE.MathUtils.randFloatSpread(2000),
                  THREE.MathUtils.randFloatSpread(2000),
                  THREE.MathUtils.randFloatSpread(2000)
              );
              stars.push(star);
          }
          let starGeo = new THREE.BufferGeometry().setFromPoints(stars);
          let starMat = new THREE.PointsMaterial({ color: 0xaaaaaa, size: 0.7 });
          let starField = new THREE.Points(starGeo, starMat);
          scene.add(starField);
          camera.position.z = 1;
          function animate() {
              requestAnimationFrame(animate);
              starField.rotation.y += 0.0002;
              renderer.render(scene, camera);
          }
          animate();
          window.addEventListener('resize', () => {
              camera.aspect = window.innerWidth / window.innerHeight;
              camera.updateProjectionMatrix();
              renderer.setSize(window.innerWidth, window.innerHeight);
          });
      }
  } catch(e) {
      console.error("Three.js background failed to load.", e);
  }

  // Reveal Animation
  const revealElements = document.querySelectorAll('.reveal');
  const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
          if (entry.isIntersecting) {
              const delay = entry.target.dataset.delay || 0;
              setTimeout(() => {
                  entry.target.style.opacity = '1';
                  entry.target.style.transform = 'translateY(0)';
              }, delay * 1000);
              revealObserver.unobserve(entry.target);
          }
      });
  }, { threshold: 0.1 });

  revealElements.forEach(el => {
      el.style.opacity = '0';
      el.style.transform = 'translateY(30px)';
      el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
      revealObserver.observe(el);
  });
});
</script>
</body>
</html>